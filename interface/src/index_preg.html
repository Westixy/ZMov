<input type="text" id="input" value=""/>
<button onclick="break_down()">Entrer</button>
<div id="result"></div>
<script>
  var input = '';

  function break_down(){
    var prem = ["John", "Edit", "Mary"];
    var deux = 'Bonjour Mon Cheval';
    var troi = '19940621';

    input = document.getElementById("input").value;

    if(input.indexOf(":") != -1){ // if the input contains ":" (search with parameters)
      // string split for parameters like a: n: d: ****************************************************
      var parameters = input.split(';');

      // specific variable
      var actors = '';
      var names = '';
      var dates = '';

      // now 2 first characters of each cell are the parameters exemple parameters[0] => "a:John Sotillo"
      for(var i = 0; i < parameters.length; i++){

        parameters[i] = parameters[i].split(":"); // split the parameter char and the value

        // all parameters are reparted on a specific variable
        switch(parameters[i][0]){
          case "a" : actors = parameters[i][1];
            break;
          case "n" : names = parameters[i][1];
            break;
          case "d" : dates = parameters[i][1];
            break;
        }
      }

      // treatment of data tables of parameters
      function stockDataSearched(tables){
        var table; // array

        if(tables.indexOf("|") != -1){ // if OR treatment has been request
          var searchTable = tables.split("|");

          table = new Array();

          for(var i = 0; i < searchTable.length; i++){

            table[table.length] = new Array();

            if(searchTable[i].indexOf("&") != -1){ // if AND treatment has been request

              tmp = searchTable[i].split("&");
              for(var d = 0; d < tmp.length; d++){
                table[i].push(tmp[d]);
              }

            }else{
              table[i].push(searchTable[i]);
            }
          }
        }else if(tables.indexOf("&") != -1){ // if AND treatment only has been request
          table = new Array;
          table[0] = tables.split("&");
        }else{
          table = new Array;
          table[0] = [tables,'']; //here there is a simple string data in actors so we put an empty cell because actor have to be an array
        }
        return table;
      }

      // data treatments
      var actor = stockDataSearched(actors); // array
      var name = stockDataSearched(names); // array
      var date = stockDataSearched(dates); // array

      var outputActor = false;
      var outputName = false;
      var outputDate = false;

      if(actor[0][0] != ''){
        // loop for artists =============================================================
        for(var i = 0; i < actor.length; i++){ // for each OR clause
          for(var c = 0; c < actor[i].length; c++){ // for each actor name
            if(actor[i][c] != ""){ // if the actor cell isn't empty
              for(var d = 0; d < prem.length; d++){ // for each actor name in the array
                if(actor[i][c] == prem[d]){ // if actor searched match to actor stocked
                  outputActor = true;
                  break;
                }else{
                  outputActor = false;
                }
              }
              if(outputActor == false){
                break;
              }
            }
          }
          if(outputActor != false){
            break;
          }
        }
      }else{
        outputActor = true;
      }

      if(name[0][0] != ''){
        // loop for Names ==============================================================
        for(var i = 0; i < name.length; i++){
          for(var c = 0; c < name[i].length; c++){
            if(name[i][c] != ""){
                if(name[i][c] == deux){
                  outputName = true;
                }else{
                  outputName = false;
                }
              if(outputName == false){
                break;
              }
            }
          }
          if(outputName != false){
            break;
          }
        }
      }else{
        outputName = true;
      }

      if(date[0][0] != ''){
        // loop for Dates ===============================================================
        for(var i = 0; i < date.length; i++){
          for(var c = 0; c < date[i].length; c++){
            if(date[i][c] != ""){
              if(date[i][c].charAt(0) == '<'){
                if(troi < date[i][c].substr(1, 8)){
                  outputDate = true;
                }else{
                  outputDate = false;
                  break;
                }
              }else if(date[i][c].charAt(0) == '>'){
                if(troi > date[i][c].substr(1, 8)){
                  outputDate = true;
                }else{
                  outputDate = false;
                  break;
                }
              }else if(date[i][c].charAt(0) == '='){
                if(troi == date[i][c].substr(1, 8)){
                  outputDate = true;
                  break;
                }
              }
            }
          }
          if(outputDate !=false){
            break;
          }
        }
      }


      //TODO : output for movie names and dates

      if(outputActor == false || outputName == false || outputDate == false){
        console.log("pas de correspondance");
      }else{
        console.log("OUI !");
      }

      // test of function
      console.log(actor);

      document.getElementById("result").innerHTML += "<br/><u>acteurs :</u><br/>";
      actor.forEach(display);
      document.getElementById("result").innerHTML += "<br/><u>Noms de films :</u><br/>";
      name.forEach(display);
      document.getElementById("result").innerHTML += "<br/><u>dates :</u><br/>";
      date.forEach(display);

    }else{
      // TODO : treatment without parameters
    }
  }
  // display results from search
  function display(element, index, array){
    document.getElementById("result").innerHTML += index + " " + element + "<br/>";
  }


</script>
